<?phpsession_start();include_once("include/common.php");if ((get_param("FormAction") <> "approval") and        (get_param("FormAction") <> "get_info") and        (get_param("FormAction") <> "del_logo") and        (get_param("FormAction") <> "toggle") and        (get_param("FormAction") <> "fee") and        (get_param("FormAction") <> "toggle_active"))    header("Content-type: text/xml");else    header('Content-Type: text/plain');$filter = tosql(urldecode(get_param("filter")), "Text");function fill_dropdown($table, $field, $value, $sWhere = '') {    global $db;    $sql = "SELECT	$value, 					$field 		  FROM 		$table ";    if ($sWhere <> "")        $sql .= " WHERE $sWhere ";    if (strstr($value, 'city')) {        $value = 'city1';        $field = 'city';    }    if (strstr($value, 'zipcode'))        $value = 'zipcode';    if (strstr($field, 'region'))        $field = 'region';    $sql .= ' ORDER BY ' . $field;    // print $sql;    $db->query($sql);    $nr = $db->next_record();    $rec = '<?xml version="1.0" encoding="iso-8859-1"?>				<dropdown>					<menuitem>						<values>							<value>, Select any ' . ucwords(get_param("FormAction")) . '</value>		     			</values>';    while ($nr) {        $rec .= '				<values>	    			<value>' . $db->f($value) . ', ' . $db->f($field) . '</value>	    	  	</values>	    	  	';        $nr = $db->next_record();    }    $rec .= '				</menuitem>			 </dropdown>';    return $rec;}// print 'get_param("FormAction"): ' . get_param("FormAction") . '<br>';if (get_param("FormAction") == "get_info") {    $user_id = get_param('user_id');//   $sql = 'INSERT into tracking_field(fld,//                                      user_profile_id,//                                      user_access_id)//                              VALUES ("' . get_param("fld") . '",//                                     ' . tosql($user_id, "Number") . ',//                                     ' . tosql($_SESSION['uid'], "Number") . '//                                     )';//   $db->query($sql);    $sql = 'INSERT INTO tracking (field_clicked,                                 profile_id,                                 user)            VALUES("' . get_param("fld") . '",                   ' . tosql($user_id, "Number") . ',                   ' . tosql($_SESSION['uid'], "Number") . ');';    $db->query($sql);    $sql = 'SELECT ' . get_param("fld") . '           FROM   user           WHERE  id=' . tosql($user_id, "Number");    print get_db_value($sql);} else if (get_param("FormAction") == "approved") {    if (get_param('is_checked') == 'true')        $is_checked = 1;    else        $is_checked = 0;    $uid = get_param('uid');    $sql = 'UPDATE user           SET    approved=' . tosql($is_checked, "Number") . '           WHERE  id=' . tosql($uid, "Number");    $db->query($sql);}else if (get_param("FormAction") == "toggle") {    $banner_id = get_param('id');    $action = get_param('b');    $sql = 'UPDATE ' . get_param("tables") . '           SET    ban=' . tosql($action, "Number") . '           WHERE  id=' . tosql($banner_id, "Number");    $db->query($sql);} else if (get_param("FormAction") == "toggle_active") {    $uid = get_param('id');    $action = get_param('b');    $sql = 'UPDATE ' . get_param("tables") . '           SET    active=' . tosql($action, "Number") . '           WHERE  id=' . tosql($uid, "Number");    $db->query($sql);} else if (get_param("FormAction") == "del_logo") {    $user_id = get_param('user_id');    $sql = 'SELECT business_logo           FROM   user           WHERE  id=' . tosql($user_id, "Number");print $sql . '<br>';    $img = get_db_value($sql);print $img . '<br>';    if (file_exists($_SERVER['DOCUMENT_ROOT'] . '/business_logo/' . $img))        unlink($_SERVER['DOCUMENT_ROOT'] . '/business_logo/' . $img);    if (file_exists($_SERVER['DOCUMENT_ROOT'] . '/business_logo/thumbs/' . $img))        unlink($_SERVER['DOCUMENT_ROOT'] . '/business_logo/thumbs/' . $img);    $sql = 'UPDATE user SET business_logo=NULL WHERE id=' . tosql($user_id, "Number");    $db->query($sql);}else if (get_param("FormAction") == "fee") {    $zip = get_param('zip');    $sql = 'SELECT type           FROM   special_zipcode           WHERE  zip=' . tosql($zip, "Text");    // print 'sql: ' . $sql. '<br>';    print get_db_value($sql);} else if (get_param("FormAction") == "state") {    print fill_dropdown('us_states', 'ucwords(region) as region', 'code');} else if (get_param("FormAction") == "city") {    $sWhere = " state=" . $filter;    print fill_dropdown('us_city', 'ucwords(city) as city', 'DISTINCT ucwords(city) as city1', $sWhere);} else if (get_param("FormAction") == "zip") {    //$sWhere = " city=" . $filter;    //print fill_dropdown('us_city', 'zipcode', 'DISTINCT IF(LENGTH(zipcode)=4, CONCAT("0", zipcode), zipcode) as z', $sWhere);    $sql = "SELECT		DISTINCT IF(LENGTH(zipcode)=4, CONCAT('0', zipcode), zipcode) as z			FROM 		us_city  			WHERE  		city=$filter  			ORDER BY 	z";    $db->query($sql);    $nr = $db->next_record();    $rec = '<?xml version="1.0" encoding="iso-8859-1"?>				<dropdown>					<menuitem>						<values>							<value>, Select any ' . ucwords(get_param("FormAction")) . '</value>		     			</values>';    while ($nr) {        $rec .= '				<values>	    			<value>' . $db->f('z') . ', ' . $db->f('z') . '</value>	    	  	</values>	    	  	';        $nr = $db->next_record();    }    $rec .= '				</menuitem>			 </dropdown>';    print $rec;}?>